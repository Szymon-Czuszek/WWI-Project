/*
SELECT
MAX(Total_Quantity),
MIN(Total_Quantity)
FROM
(
*/
SELECT
  p.FULLNAME,
  EXTRACT(YEAR FROM o.ORDERDATE) AS ORDER_YEAR,
  SUM(l.QUANTITY) AS Total_Quantity,
  WIDTH_BUCKET(SUM(l.QUANTITY), 115000, 315000, 5) AS Bucket,
   CASE
       WHEN WIDTH_BUCKET(SUM(l.QUANTITY), 115000, 315000, 5) = 1 THEN 500
       WHEN WIDTH_BUCKET(SUM(l.QUANTITY), 115000, 315000, 5) = 2 THEN 1000
       WHEN WIDTH_BUCKET(SUM(l.QUANTITY), 115000, 315000, 5) = 3 THEN 1500
       WHEN WIDTH_BUCKET(SUM(l.QUANTITY), 115000, 315000, 5) = 4 THEN 2000
       WHEN WIDTH_BUCKET(SUM(l.QUANTITY), 115000, 315000, 5) = 5 THEN 2500
   END AS Bonus
FROM
  WWI.ORDERLINES l
JOIN
  WWI.ORDERS o ON l.ORDERID = o.ORDERID
JOIN
  WWI.PEOPLE2 p ON o.SALESPERSONPERSONID = p.PERSONID
GROUP BY
  EXTRACT(YEAR FROM o.ORDERDATE),
  p.FULLNAME
ORDER BY
   p.FULLNAME, ORDER_YEAR
--)
;